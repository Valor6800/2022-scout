<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Valor Scout</title>

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" type="text/css" href="./styles.css">
    <script type="text/javascript" src="dist/sorttable.js"></script>
  </head>

  <body class="w3-padding-64">

      <div class="w3-top w3-bar w3-black w3-hide-small">
        <a href="index.html" class="w3-bar-item w3-button" id="home_button">Home</a>
        <a href="all.html" class="w3-bar-item w3-button">All regionals/districts</a>
        <a href="prediction.html" class="w3-bar-item w3-button">Match Prediction</a>
        <a href="#" class="w3-bar-item w3-button w3-mobile w3-right viper-black-hover" id="questions_button">
          <i class="fa fa-question-circle" alt="Questions?"></i>
        </a>
      </div>

    <!-- Navbar on small screens (Hidden on medium and large screens) -->
    <div class="w3-top w3-light-grey w3-hide-large w3-hide-medium" id="myNavbar">
      <div class="w3-bar w3-center w3-large">
        <a href="index.html" class="w3-bar-item w3-button w3-grey" style="width:25% !important" id="home_button"><i class="fa fa-home" alt="Home"></i></a>
        <a href="all.html" class="w3-bar-item w3-button w3-light-grey" style="width:25% !important">All</a>
        <a href="prediction.html" class="w3-bar-item w3-button w3-light-grey" style="width:25% !important">Predict</a>
      </div>
    </div>

    <!-- Page Content -->
    <div class="w3-padding-large" id="main">
      
      <!-- Questions pop-up -->
      <div id="questions_alert" class="w3-justify w3-panel grey-no-hover w3-display-container w3-animate-opacity">
        <span id="getStartedClose" class="w3-button w3-xlarge red-hover w3-display-topright">&times;</span>
        <h3>Getting Started</h3>
        <p>Use the search-bar below and start typing a name, location, or code for a regional or district event.
        After finding your event, click the row to open up the stats page</p>
        <p>OPR on this site is generated by summing up all columns EXCEPT penalties. OPRP is OPR with penalties subtracted,
        which is an attempt to penalize teams that are committing lots of fouls.</p>
        <p>The OPR you see here WILL be different from thebluealliance.com as TBA only uses final scores for its' OPR calculations,
        which has penalties baked in</p>
      </div>

      <!-- Container for the item content viewer -->
      <div class="w3-justify w3-card w3-white" id="regional_details">
        <header class="w3-container viper-black-no-hover">
          <h3>Team <span id="team_number"></span> - General OPR</h3>
        </header>

        <!-- OPR table -->
        <table class="sortable w3-card w3-table w3-striped w3-hoverable" id="opr_table">
        <!--Generated items will go here-->
        </table>

        <div id="opr_error">
        </div>

      </div>

      <hr>

      <!-- Container for the item content viewer -->
      <div class="w3-justify w3-card w3-white" id="cargo_details">
        <header class="w3-container viper-black-no-hover">
          <h3>Cargo OPR</h3>
        </header>

        <table class="sortable w3-card w3-table w3-striped w3-hoverable" id="cargo_table">
        <!--Generated items will go here-->
        </table>

      </div>

      <hr>

      <!-- Container for the cargo breakdown content viewer -->
      <div class="w3-justify w3-card w3-white" id="cargo_lower_breakdown">
        <header class="w3-container viper-black-no-hover">
          <h3>Lower Cargo Exit Breakdown</h3>
        </header>
        <table class="sortable w3-card w3-table w3-striped w3-hoverable" id="cargo_lower_table">
        </table>
      </div>

      <hr>

      <!-- Container for the cargo breakdown content viewer -->
      <div class="w3-justify w3-card w3-white" id="cargo_upper_breakdown">
        <header class="w3-container viper-black-no-hover">
          <h3>Upper Cargo Exit Breakdown</h3>
        </header>
        <table class="sortable w3-card w3-table w3-striped w3-hoverable" id="cargo_upper_table">
        </table>
      </div>

      <hr>

      <div class="w3-justify w3-card w3-white">
        <header class="w3-container viper-black-no-hover">
          <h3>Key</h3>
        </header>
        <p>
          <table class="sortable w3-card w3-table w3-striped w3-hoverable">
            <thead class="viper-grey">
              <td>Zone</td>
              <td>Red Alliance</td>
              <td>Blue Alliance</td>
            </thead>
            <tr>
              <td>Front</td>
              <td>Red</td>
              <td>Blue</td>
            </tr>
            <tr>
              <td>Back</td>
              <td>Blue</td>
              <td>Red</td>
            </tr>
            <tr>
              <td>Left</td>
              <td>Near</td>
              <td>Far</td>
            </tr>
            <tr>
              <td>Right</td>
              <td>Far</td>
              <td>Near</td>
            </tr>
          </table>
        </p>
        <img src="https://www.chiefdelphi.com/uploads/default/original/3X/5/f/5f678e3fcbe72aac488b0a579a4c20ebe4761b11.jpeg" style=" max-width:100%;">
      </div>

    <!-- END PAGE CONTENT -->
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.6.0/math.js"></script>
    <script type="text/javascript" src="dist/scripts.js"></script>
    <script src="./dist/min.tba.js"></script>
    <script src="./dist/min.tba_generator.js"></script>
  </body>

<script id="cargo-header-table" type="text/template">
    <thead class="viper-grey">
        <td>Mode</td>
        <td>Front</td>
        <td>Back</td>
        <td>Left</td>
        <td>Right</td>
    </thead>
</script>

<script id="cargo-lower-template-table-entry" type="text/template">
    <tr class="table_entry" >
        <td>Auto</td>
        <td>{{autoLowerFront}}</td>
        <td>{{autoLowerBack}}</td>
        <td>{{autoLowerLeft}}</td>
        <td>{{autoLowerRight}}</td>
    </tr>
    <tr class="table_entry" >
        <td>Teleop</td>
        <td>{{teleopLowerFront}}</td>
        <td>{{teleopLowerBack}}</td>
        <td>{{teleopLowerLeft}}</td>
        <td>{{teleopLowerRight}}</td>
    </tr>
    <tr class="table_entry" >
        <td>Total</td>
        <td>{{totalLowerFront}}</td>
        <td>{{totalLowerBack}}</td>
        <td>{{totalLowerLeft}}</td>
        <td>{{totalLowerRight}}</td>
    </tr>
</script>

<script id="cargo-upper-template-table-entry" type="text/template">
    <tr class="table_entry" >
        <td>Auto</td>
        <td>{{autoUpperFront}}</td>
        <td>{{autoUpperBack}}</td>
        <td>{{autoUpperLeft}}</td>
        <td>{{autoUpperRight}}</td>
    </tr>
    <tr class="table_entry" >
        <td>Teleop</td>
        <td>{{teleopUpperFront}}</td>
        <td>{{teleopUpperBack}}</td>
        <td>{{teleopUpperLeft}}</td>
        <td>{{teleopUpperRight}}</td>
    </tr>
    <tr class="table_entry" >
        <td>Total</td>
        <td>{{totalUpperFront}}</td>
        <td>{{totalUpperBack}}</td>
        <td>{{totalUpperLeft}}</td>
        <td>{{totalUpperRight}}</td>
    </tr>
</script>

<script id="opr-header-table" type="text/template">
    <thead class="viper-grey">
        <td>OPR</td>
        <td>OPRP</td>
        <td>Taxi</td>
        <td>Climb</td>
        <td>Auto Cargo</td>
        <td>Teleop Cargo</td>
        <td>Penalty</td>
    </thead>
</script>

<script id="opr-special-header-table" type="text/template">
    <thead class="viper-grey">
        <td>Mode</td>
        <td>Cargo</td>
        <td>Cargo Upper</td>
        <td>Cargo Lower</td>
    </thead>
</script>

<script id="opr-template-table-entry" type="text/template">
    <tr class="table_entry" >
        <td>{{opr}}</td>
        <td>{{oprp}}</td>
        <td>{{taxi}}</td>
        <td>{{climb}}</td>
        <td>{{auto}}</td>
        <td>{{teleop}}</td>
        <td>{{penalty}}</td>
    </tr>
</script>

<script id="opr-special-template-table-entry" type="text/template">
    <tr class="table_entry" >
        <td>Auto</td>
        <td>{{auto}}</td>
        <td>{{autoCargoUpper}}</td>
        <td>{{autoCargoLower}}</td>
    </tr>
    <tr class="table_entry" >
        <td>Teleop</td>
        <td>{{teleop}}</td>
        <td>{{teleopCargoUpper}}</td>
        <td>{{teleopCargoLower}}</td>
    </tr>
    <tr class="table_entry" >
        <td>Total</td>
        <td>{{total}}</td>
        <td>{{totalCargoUpper}}</td>
        <td>{{totalCargoLower}}</td>
    </tr>
</script>

<script>
    
    $('#getStartedClose').on('click', function() {
        $('#questions_alert').hide();
        Cookies.set('getStartedClose', true, { expires: 365 });
    });
    
    $('#questions_button').on('click', function() {
      $("#questions_alert").show();
    });
    var tba = new TBA();
    tba.setYear('2022');
    tba.setAuthToken('LCBZ7qqYrBR0e06C4QJEjaW1O7r2TZat7KZwvQcfDqShwIxV4N7epHK9lbafjc4M');

    var url = new URL(window.location.href);
    var key = url.searchParams.get("event");
    var team = url.searchParams.get("team");

    $('#team_number').html(team);

    tba.genOPRs(key, function(results) {

        // Cache of the template
        var OPRheader = document.getElementById("opr-header-table");
        var OPRSpecialHeader = document.getElementById("opr-special-header-table");
        var OPRtemplate = document.getElementById("opr-template-table-entry");
        var OPRSpecialTemplate = document.getElementById("opr-special-template-table-entry");
        // Get the contents of the template
        var OPRHeaderHtml = OPRheader.innerHTML;
        var OPRTemplateHtml = OPRtemplate.innerHTML;
        var OPRSpecialHeaderHtml = OPRSpecialHeader.innerHTML;
        var OPRSpecialTemplateHtml = OPRSpecialTemplate.innerHTML;

        var Cargoheader = document.getElementById("cargo-header-table");
        var CargoLowerTemplate = document.getElementById("cargo-lower-template-table-entry");
        var CargoUpperTemplate = document.getElementById("cargo-upper-template-table-entry");

        var CargoHeaderHtml = Cargoheader.innerHTML;
        var CargoLowerTemplateHtml = CargoLowerTemplate.innerHTML;
        var CargoUpperTemplateHtml = CargoUpperTemplate.innerHTML;

        if (results) {
            // Final HTML variable as empty string
            var oprHtml = OPRHeaderHtml;
            var oprSpecialHtml = OPRSpecialHeaderHtml;
            oprHtml += OPRTemplateHtml.replace(/{{opr}}/g, results[team].opr.toFixed(2))
                                  .replace(/{{oprp}}/g, results[team].oprp.toFixed(2))
                                  .replace(/{{taxi}}/g, results[team].taxi.toFixed(2))
                                  .replace(/{{climb}}/g, results[team].climb.toFixed(2))
                                  .replace(/{{auto}}/g, (results[team].autoCargoUpper + results[team].autoCargoLower).toFixed(2))
                                  .replace(/{{teleop}}/g, (results[team].teleopCargoUpper + results[team].teleopCargoLower).toFixed(2))
                                  .replace(/{{penalty}}/g, results[team].penalty.toFixed(2))

            oprSpecialHtml += OPRSpecialTemplateHtml.replace(/{{auto}}/g, (results[team].autoCargoUpper + results[team].autoCargoLower).toFixed(2))
                                  .replace(/{{autoCargoUpper}}/g, results[team].autoCargoUpper.toFixed(2))
                                  .replace(/{{autoCargoLower}}/g, results[team].autoCargoLower.toFixed(2))
                                  .replace(/{{teleop}}/g, (results[team].teleopCargoUpper + results[team].teleopCargoLower).toFixed(2))
                                  .replace(/{{teleopCargoUpper}}/g, results[team].teleopCargoUpper.toFixed(2))
                                  .replace(/{{teleopCargoLower}}/g, results[team].teleopCargoLower.toFixed(2))
                                  .replace(/{{total}}/g, (results[team].teleopCargoUpper + results[team].teleopCargoLower + results[team].autoCargoUpper + results[team].autoCargoLower).toFixed(2))
                                  .replace(/{{totalCargoUpper}}/g, (results[team].teleopCargoUpper + results[team].autoCargoUpper).toFixed(2))
                                  .replace(/{{totalCargoLower}}/g, (results[team].teleopCargoLower + results[team].autoCargoLower).toFixed(2))

            var cargoLowerHtml = CargoHeaderHtml;
            var cargoUpperHtml = CargoHeaderHtml;
            cargoLowerHtml += CargoLowerTemplateHtml.replace(/{{autoLowerFront}}/g, results[team].autoLowerFront)
                                                    .replace(/{{autoLowerBack}}/g, results[team].autoLowerBack)
                                                    .replace(/{{autoLowerLeft}}/g, results[team].autoLowerLeft)
                                                    .replace(/{{autoLowerRight}}/g, results[team].autoLowerRight)
                                                    .replace(/{{teleopLowerFront}}/g, results[team].teleopLowerFront)
                                                    .replace(/{{teleopLowerBack}}/g, results[team].teleopLowerBack)
                                                    .replace(/{{teleopLowerLeft}}/g, results[team].teleopLowerLeft)
                                                    .replace(/{{teleopLowerRight}}/g, results[team].teleopLowerRight)
                                                    .replace(/{{totalLowerFront}}/g, results[team].teleopLowerFront + results[team].autoLowerFront)
                                                    .replace(/{{totalLowerBack}}/g, results[team].teleopLowerBack + results[team].autoLowerBack)
                                                    .replace(/{{totalLowerLeft}}/g, results[team].teleopLowerLeft + results[team].autoLowerLeft)
                                                    .replace(/{{totalLowerRight}}/g, results[team].teleopLowerRight + results[team].autoLowerRight)
                                        

            cargoUpperHtml += CargoUpperTemplateHtml.replace(/{{autoUpperFront}}/g, results[team].autoUpperFront)
                                                    .replace(/{{autoUpperBack}}/g, results[team].autoUpperBack)
                                                    .replace(/{{autoUpperLeft}}/g, results[team].autoUpperLeft)
                                                    .replace(/{{autoUpperRight}}/g, results[team].autoUpperRight)
                                                    .replace(/{{teleopUpperFront}}/g, results[team].teleopUpperFront)
                                                    .replace(/{{teleopUpperBack}}/g, results[team].teleopUpperBack)
                                                    .replace(/{{teleopUpperLeft}}/g, results[team].teleopUpperLeft)
                                                    .replace(/{{teleopUpperRight}}/g, results[team].teleopUpperRight)
                                                    .replace(/{{totalUpperFront}}/g, results[team].teleopUpperFront + results[team].autoUpperFront)
                                                    .replace(/{{totalUpperBack}}/g, results[team].teleopUpperBack + results[team].autoUpperBack)
                                                    .replace(/{{totalUpperLeft}}/g, results[team].teleopUpperLeft + results[team].autoUpperLeft)
                                                    .replace(/{{totalUpperRight}}/g, results[team].teleopUpperRight + results[team].autoUpperRight)

            // Replace the HTML of #list with final HTML
            document.getElementById("opr_table").innerHTML = oprHtml;
            document.getElementById("cargo_table").innerHTML = oprSpecialHtml;
            document.getElementById("cargo_lower_table").innerHTML = cargoLowerHtml;
            document.getElementById("cargo_upper_table").innerHTML = cargoUpperHtml;
            sorttable.makeSortable(document.getElementById("opr_table"));

        } else {
            document.getElementById("opr_error").innerHTML = "No data found for this regional/district yet!";
        }
    });
</script>
</html>
